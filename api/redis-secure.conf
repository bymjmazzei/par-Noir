# Secure Redis Configuration for Identity Protocol
# Place this file at /etc/redis/redis.conf

# =============================================================================
# NETWORK SECURITY
# =============================================================================

# Bind to localhost only - prevents external access
bind 127.0.0.1

# Protected mode - prevents external connections
protected-mode yes

# Port configuration
port 6379

# TCP keepalive
tcp-keepalive 300

# Timeout for idle clients
timeout 0

# =============================================================================
# AUTHENTICATION & ACCESS CONTROL
# =============================================================================

# Strong password requirement
requirepass "your-super-secure-redis-password-change-this"

# Disable dangerous commands
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command CONFIG ""
rename-command SHUTDOWN ""
rename-command DEBUG ""

# =============================================================================
# MEMORY MANAGEMENT
# =============================================================================

# Memory limit (adjust based on your needs)
maxmemory 256mb

# Memory policy - remove least recently used keys
maxmemory-policy allkeys-lru

# Memory fragmentation ratio
activedefrag yes
active-defrag-ignore-bytes 100mb
active-defrag-threshold-lower 10
active-defrag-threshold-upper 100

# =============================================================================
# PERSISTENCE SECURITY
# =============================================================================

# Disable persistence for sensitive data
# This prevents sensitive data from being written to disk
save ""
appendonly no

# If persistence is needed for non-sensitive data, use:
# save 900 1
# save 300 10
# save 60 10000
# appendonly yes
# appendfsync everysec

# =============================================================================
# LOGGING & MONITORING
# =============================================================================

# Log level
loglevel notice

# Log file
logfile /var/log/redis/redis-server.log

# Syslog
syslog-enabled yes
syslog-ident redis

# =============================================================================
# PERFORMANCE & STABILITY
# =============================================================================

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit slave 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# TCP backlog
tcp-backlog 511

# Databases
databases 16

# =============================================================================
# SECURITY BEST PRACTICES
# =============================================================================

# Disable slow log (can leak sensitive data)
slowlog-log-slower-than -1

# Disable latency monitor (can leak timing data)
latency-monitor-threshold 0

# Disable notify-keyspace-events (can leak data)
notify-keyspace-events ""

# =============================================================================
# TLS CONFIGURATION (Optional - for additional security)
# =============================================================================

# Uncomment these lines if you want TLS encryption
# tls-port 6380
# tls-cert-file /path/to/redis.crt
# tls-key-file /path/to/redis.key
# tls-ca-cert-file /path/to/ca.crt
# tls-auth-clients no
